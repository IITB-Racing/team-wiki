<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>EKF SLAM - IIT Bombay Racing Team</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "EKF SLAM";
        var mkdocs_page_input_path = "estimation\\ekf_slam.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> IIT Bombay Racing Team
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../goal/">Goal 2024</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../dates/">Key dates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../howto/">How to guides</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../updates/">Weekly priorities</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Perception</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../perception/overview/">Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Estimation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">EKF SLAM</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#motion-update">Motion Update</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#measurement-update">Measurement Update</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#serial-vs-parallel-structre">Serial Vs Parallel Structre</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#loop-closure">Loop Closure</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#what-went-well">What went well?</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#what-didnt-went-well">What didnt went well?</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#what-we-did">What we did?</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#what-is-the-plan-for-future">What is the plan for future?</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Path Planning and Controls</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../controls/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../controls/planning/">Path Planning</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../controls/controls/">Controls</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">System integation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../sysint/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../sysint/can/">CAN</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">IIT Bombay Racing Team</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Estimation &raquo;</li>
      <li>EKF SLAM</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div><h1 id="ekf-slam">EKF SLAM</h1>
<p>Since the competition track would contain only cones, a feature/landmark based mapping is sufficient. Also, as the total number of features (or cones) will not be very high, EKF SLAM (being extensively researched) has shown that with a slightly modified architecture, it is real-time capable. Although not the most efficient algorithm (especially for complex scenarios), it has proved to be a good starting point for us.</p>
<p>The algorithm can be divided in 2 steps:<br>
1. Motion Update<br>
2. Measurement Update
<img alt="ekf slam structure" src="../ekf_slam_structure.png"></p>
<h3 id="motion-update">Motion Update</h3>
<ul>
<li>We have used a simple motion model so that it updates the state frequently which is essential for real-time capabilities, with its output depending on the frequency of the odometry data (which is ~100 Hz).</li>
<li>Due to inconsistency in input frequencies (because of reasons like synchronizing from multiple sensors and performance issues) a real-time sync Δt is implemented, calculated dynamically by the time taken to perform the motion update again. This results in slightly better estimations from the motion model.</li>
</ul>
<h3 id="measurement-update">Measurement Update</h3>
<ul>
<li>The measurement update step is computationally heavy as it checks for the matches between new measurements and the existing map which may lead to correction of the entire map and position of the car, i.e. complete state and covariance matrix have to be adjusted. The time taken largely depends on the square of the number of landmarks present on the map (or simply map size).</li>
<li>The measurements of the observed cones for the measurement update, if taken from the camera, have a larger scope for error compared with lidar depths. Since the ICNN (Individually Compatible Nearest Neighbour) approach for data association is very sensitive to the increase in vehicle and sensor error, spurious pairings can easily be formed and will never be reconsidered. Hence, the JCBB (Joint Compatibility Branch and Bound) algorithm for data association was selected. Experiments have shown that JCBB is not only more robust than Nearest Neighbour, but also feasible in terms of computational cost.</li>
<li>Because of the unavoidable errors in the sensors, some false positive landmarks can be recorded, which hamper the Path Planning algorithm and the data association step of the measurement update. This can be eliminated by keeping a threshold value for the number of times a landmark is observed. If the cone is under the threshold, it's removed from the map.</li>
</ul>
<h5 id="serial-vs-parallel-structre">Serial Vs Parallel Structre</h5>
<ul>
<li>Initially, we tried to use the serial structure in which the motion update step is performed just after the measurement step is finished. This will not be real-time capable because the next motion update cannot begin until the measurement update is finished as measurement update takes a large time to finish. Also this presented a potential risk to the path planning algorithm, as an outdated car position could have serious consequences.
<img alt="serial structure of motion and measurement update" src="../serial_structure.png"></li>
</ul>
<!-- *<center>Fig:</center>* -->
<ul>
<li>The answer to this problem is the parallelization of the motion and measurement update steps.
<img alt="parallel structure of motion and measurement update" src="../parallel_structure.png"></li>
<li>The updated pose was adjusted for the difference in the initial pose to account for the prediction made since the measurement was received. This allows the algorithm to keep predicting the position estimated while performing the measurement step in the background. </li>
<li>This solves all of the problems mentioned above: the data is processed at different frequencies so there is always a short-term pose available for the subsequent module (Path Planning) to work with, and measurement update can take the required time until it is completed or until a new measurement from sensors is available.</li>
</ul>
<h3 id="loop-closure">Loop Closure</h3>
<ul>
<li>After one lap of the track, a static map is created and further observations will not increase the quality of the map significantly. This detection of the completion of a lap is called Loop Closure.</li>
<li>This also increases the overall accuracy of all landmarks, as when the car is about to complete a loop, it re-observes some of the old landmarks(error in the location of these landmarks is very less).</li>
<li>Incorrect loop closure results in catastrophic failure of SLAM and needs to be avoided to create a reliable system.</li>
<li>Loop closure is identified using three conditions:<br><ol>
<li>It should detect orange cones (which mark starting and stopping positions).</li>
<li>The estimated position of the car should be very similar to that of the initial position(±1m).</li>
<li>The car's current heading has to be similar to the initial heading(±5°).</li>
</ol>
</li>
<li>After detecting loop closure, the car shifts from SLAM to Localization mode, where only the car's position is adjusted based on the cones detected.</li>
</ul>
<h4 id="what-went-well">What went well?</h4>
<ul>
<li>We were able to run motion update and get pretty good results on everything FSDS simulator, Carmaker, Bot, and ADS-DV.</li>
<li>Loop closure was detected accurately on the FSDS simulator.</li>
</ul>
<h4 id="what-didnt-went-well">What didnt went well?</h4>
<ul>
<li>We werent able to run measurement update on the FSDS . It could be due to the erroneous reading(wrong depthmap) provided by the simulator or an error in data association part of the algorithm we wrote.</li>
<li>As measurement update didnt work, there was no point in trying in the parallel structure of motion update and measurment. </li>
</ul>
<h4 id="what-we-did">What we did?</h4>
<ul>
<li>we chose to utilize available libraries and packages, which allowed for faster experimentation but provided less flexibility. Despite this limitation, these libraries served as a foundation for improving the precision and accuracy of our results.</li>
</ul>
<h4 id="what-is-the-plan-for-future">What is the plan for future?</h4>
<ul>
<li>Run measurement update on FSDS(using false perception reading), Carmaker and bot</li>
<li>Make all the custom changes like other teams did(eg. keeping a threshold on number of times a landmark is seen before entering it in map)</li>
<li>Implement parallel structure of motion and measurment update</li>
<li>Implement Localisation part of the algorithm as well and check it on the simulators.</li>
<li>On loop closure, implement conversion from SLAM to Localisation.</li>
</ul>
<p>written by Shreyash Gupta</p></div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../overview/" class="btn btn-neutral float-left" title="Overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../controls/overview/" class="btn btn-neutral float-right" title="Overview">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../overview/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../controls/overview/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
