<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Overview - IIT Bombay Racing Team</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Overview";
        var mkdocs_page_input_path = "estimation\\overview.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> IIT Bombay Racing Team
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../goal/">Goal 2024</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../dates/">Key dates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../howto/">How to guides</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../updates/">Weekly priorities</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Perception</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../perception/overview/">Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Estimation</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Overview</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#what-we-did-in-2022-23">What we did in 2022-23</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#initial-plan">Initial Plan</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#what-wasnt-going-well">What wasn't going well</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#how-we-tried-to-resolve-it">How we tried to resolve it</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#what-could-be-done-next">What could be done next?</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#algorithms-explored-till-now">Algorithms explored till now</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ekf_slam/">EKF SLAM</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Path Planning and Controls</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../controls/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../controls/planning/">Path Planning</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../controls/controls/">Controls</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">System integation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../sysint/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../sysint/can/">CAN</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">IIT Bombay Racing Team</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Estimation &raquo;</li>
      <li>Overview</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div><h1 id="overview">Overview</h1>
<p><strong>TO ADD:</strong> what we are planning to do this year...</p>
<h2 id="what-we-did-in-2022-23">What we did in 2022-23</h2>
<p><strong>TL;DR:</strong> We initially planned to implement our own EKF SLAM algorithm in FSDS, but encountered problems with the data association step. Later found that the measurements coming in from the camera and lidar sensors were not correct. After spending several months trying to fix these problems, the team decided to implement SLAM libraries that are integrated with ROS - Cartographer &amp; MRPT. Cartographer worked, but it produced a map that was not compatible with the PPC algorithm. MRPT worked better, but it only stored the positions of landmarks, not their colors. We fixed it using a "jugaad".</p>
<h4 id="initial-plan">Initial Plan</h4>
<p>We started to continue with the previous year's work, implementing the EKF SLAM algorithm. We were having some trouble implementing the measurement update (specifically, the data association part). This year the team made a decision to start working with the FSDS simulutor since it provides a realistic environment and not just some dummy sensors (were using FSSIM before).</p>
<p><div class="video-container"><video style="position:relative;width:100%;height:22.172vw" loop muted autoplay alt="type:video"><source src="../fastslam-fssim-trimmed.webm" type="video/mp4"></source></video></div><br>
<em><center>Fig: EKF SLAM (Motion update only) on FSSIM, before we started</center></em></p>
<p>After setting up the simulator, we were able to run motion update with some effort, at the start of August. For trying to solve the data associtation problem, we saw many teams use an algorithm called JCBB (Joint Compatibility Branch and Bound) which is supposed to be more robust and faster than the Nearest Neighbour approach (<a href="https://web.mit.edu/2.166/www/handouts/Neira_TRA_2001.pdf">check this paper</a>). We referred to these <a href="https://github.com/ayrmoney/SLAM-by-J.-Neira">codes</a> for the implementation of JCBB. Since, different sources had different assumptions regarding the EKF algorithm, which meant different matrices with different sizes, it created a lot of confusion on which one to choose. We looked into the algorithm proofs, which helped in deciding that to some extent. But we still were getting very weird results, and were certainly not close to fixing the issue.</p>
<p><img alt="motion &amp; meas" src="../motion%20%26%20meas.png">
<em><center>Fig: Motion update (left) and Measurement update (right) on FSDS</center></em></p>
<p>For detecting loop closure, we researched what other teams have implemented (<strong>list sources</strong>), and came out with the criterias that would have to match for a loop closure to be detected and hence switching from SLAM to Locaclization.</p>
<p>This <strong><a href="https://github.com/dv-software-22-23/slam/tree/FSDS_EKF_PPC_Fusion">repository</a></strong> contains the most updated code for the EKF SLAM algorithm implemented. Check <a href="../ekf_slam/">EKF SLAM</a> for more details.</p>
<h4 id="what-wasnt-going-well">What wasn't going well</h4>
<p>After a lot of trying, we found out that the measurements coming in with Camera and Lidar, with ROS bridge are not correct (they seem fine with the python client). Running camera also causes the simulator to have performence issues, <a href="https://github.com/FS-Driverless/Formula-Student-Driverless-Simulator/issues/292">see issue on github</a>. </p>
<p>By this time, we had already spent a lot of time on fixing measurement update issue (~3-4 months), and weren't confident enough to fix that before this season, which caused us to take a pause think about a different approach to implement SLAM. We explored a lot of libraries that provide SLAM implementations and found many are integrated with ROS itself (check out <strong><a href="https://www.notion.so/ayrmoney/074538d9292a4b3daaf3b22b06ab1cec?v=60693a31d0b9473c93a860b24671c1cd&amp;pvs=4">libraries for SLAM</a></strong> for details on slam libraries we explored).</p>
<table>
<thead>
<tr>
<th>Library name</th>
<th>Status</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td>rgbdslam_v2</td>
<td>Didn't start</td>
<td>ros-kinetic, c++, boht realistic map</td>
</tr>
<tr>
<td>orb_slam3</td>
<td>Halted</td>
<td>tutorial of running it in FSDS, nvidia-docker requires nvidia gpu</td>
</tr>
<tr>
<td>ov2_slam</td>
<td>Didn't start</td>
<td>stereo visual slam, ros melodic</td>
</tr>
<tr>
<td>mrpt</td>
<td>Works!</td>
<td>many types of algorithms, has range-bearing EKF</td>
</tr>
<tr>
<td>cartographer</td>
<td>Works!</td>
<td>LaserScan, occupancy grid</td>
</tr>
<tr>
<td>gmapping</td>
<td>Didn't start</td>
<td>LaserScan, occupancy grid</td>
</tr>
<tr>
<td>rtabmap</td>
<td>Didn't start</td>
<td>bunch of inputs/subscribers, RGBD</td>
</tr>
<tr>
<td>gtsam</td>
<td>Didn't start</td>
<td>landmark based example given, ros integration?</td>
</tr>
<tr>
<td>servo</td>
<td>Didn't start</td>
<td>used by AMZ team</td>
</tr>
</tbody>
</table>
<h4 id="how-we-tried-to-resolve-it">How we tried to resolve it</h4>
<p>We went ahead to first implement <strong>Cartographer</strong> ROS library as it had good documentation and was comparatively fairly recent too. With some effort, we were able to get it working with FSDS. We ran it with the bag recorded with PPC running controlling the car to follow middle line (following the tutorial <a href="https://google-cartographer-ros.readthedocs.io/en/latest/your_bag.html">here</a>). It worked but the results were not impressive, it was still mostly dependent on the odometry data we were providing, (motion update) and only did slight improvements to it. We also couldn't test it along with PPC, as Cartographer provides a occupancy grid type map, which is not what PPC expected (simple list/dict of cone position and color).</p>
<p><img alt="cartographer" src="../cartographer.png">
<em><center>Fig: Cartographer result, very little improvements (purple line: odometry estimation, green: output from Cartographer)</center></em></p>
<p>There was only one ROS-integrated SLAM library, we found that could produce a simple map that PPC already worked with - <strong>MRPT</strong>. Implementing it was similar to Cartographer, so that helped. Since, still the issue of 'bad measurements' existed in the FSDS simulator, we had to work with fake measurements (returns the ground truth positions/color of cones relative to the car). With that its results were decent and we were able to get it running with PPC as well. One thing we missed - MRPT (ekf_slam_2d) only uses/stores the positions of landmarks (i.e. cones) and not their color, which again is a issue because PPC needs it to calculate the path to be followed. This was fixed as a 'jugaad' by using... <strong>(explain how we fixed it).</strong></p>
<h4 id="what-could-be-done-next">What could be done next?</h4>
<p>Explain what we could do next to improve the results, and how we may move further.</p>
<h2 id="algorithms-explored-till-now">Algorithms explored till now</h2>
<p>List the algorithms/libraries we have explored till now, and give a breif description of each's implementation, the postives/negatives.</p>
<ul>
<li>EKF SLAM</li>
<li>FastSLAM</li>
<li>MRPT</li>
<li>Cartographer</li>
</ul>
<p>written by Ayush Rohilla</p></div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../perception/overview/" class="btn btn-neutral float-left" title="Overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../ekf_slam/" class="btn btn-neutral float-right" title="EKF SLAM">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../perception/overview/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../ekf_slam/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
